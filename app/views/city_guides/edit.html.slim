.page-wrapper
	.header-wrapper
		.cityguide-header style=("background: url('#{@city_guide.uploaded_files.last.file.url(:large)}') no-repeat fixed; background-size:cover;")			
		h1
					= @city_guide.name
	.container
		.row
			ul.place-list.list-unstyled.ui-sortable#sortable
			
				- @city_guide_places.each do |city_guide_place|
					
					= render partial: 'show_place', locals: {place: city_guide_place.place, city_guide_place: city_guide_place} 
						
				= render 'add_place' if @city_guide_places.count < 5
			- if @city_guide_places.count >= 5
				.col-xs-12
					p Want to add anew awesome place? You need to tick one out of your guide first, sorry :)
						
= render "add_place_modal"
.md-overlay
= content_for :js do
	= javascript_include_tag "classie.js"
	= javascript_include_tag "city_guides/sortable_list.js"
	= javascript_include_tag "city_guides/foursquare.js"
	= javascript_include_tag "city_guides/city_guide_places.js"
	= javascript_include_tag "city_guides/newUpload.js"
	
	javascript:

		$(document).on('click', '#user_input_foursquare', function () {
			initFoursquare({
				city : #{{(@city_guide.city.gsub(" ","%20")+ "," + @city_guide.state).to_json}},
				city_guide_id : #{{@city_guide.id}}
				})
      		var city = #{{(@city_guide.city.gsub(" ","%20")+ "," + @city_guide.state).to_json}};
      		var $this = $(this);
      		var $that = $this.parentsUntil($('form #new_place'));
      		console.log($that);
      		$this.autocomplete({
      			source: function(request, response) {
      					fs_suggest(response, {
      						near: city, 
      						query: request.term
      						}
      					)
      				},
      			minLength : 3,
      			focus: function( event, ui ) {
      			        $this.val( ui.item.name );
      			        return false;
      			      },
      		  	select: function( event, ui ) {	
      		  	  fs_complete($that, ui.item)
      		  	  $this.val( ui.item.name );
      		  	  return false;
      		  	},	
      		});
      	});